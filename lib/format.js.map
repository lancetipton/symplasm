{"version":3,"sources":["format.js"],"names":["options","root","tagConvert","attrKeyConvert","attrValueConvert","attrKeyAdd","trim","lowerCaseTag","comments","selectorCheck","attrArrEmpty","convertBlock","block","nodes","children","data","runAction","action","node","key","value","Object","keys","reduce","attrs","useKey","length","map","child","buildBlock","org","added","assign","args","tagName","toLowerCase","Array","isArray","format","parent","childs","type","filterFS","formatNode","push","formatAttributes","attributes","parts","item","formatValue","addAttribute","def","shouldUpdateValue","tagType","nodeAttrs","attsIsArr","selector","updateVal","all","toCheck","indexOf","isValid","attr","split","start","end","text","content","replace","formatFS","_options","rootFS"],"mappings":"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","file":"format.js","sourcesContent":["import {\n  addChildren,\n  convertStyle,\n  setupSelectors,\n  splitKeyValue,\n  unquote\n} from './helpers'\n\nlet options = {\n  root: {\n    0: 'div',\n  },\n  tagConvert: {},\n  attrKeyConvert: {},\n  attrValueConvert: {},\n  attrKeyAdd: {},\n  trim: false,\n  lowerCaseTag: true,\n  comments: true\n}\n\nlet selectorCheck = {\n  tagConvert: {},\n  attrKeyConvert: {},\n  attrValueConvert: {},\n  attrKeyAdd: {},\n}\nlet attrArrEmpty = true\n\n\nconst convertBlock = (block, nodes, children) => {\n\n  const data = selectorCheck.tagConvert[block[0]]\n    ? runAction({\n        action: selectorCheck.tagConvert[block[0]],\n        node: block,\n        key: '$$DOM_TAG_NAME',\n        value: block[0],\n        nodes,\n        children\n      }, 'value')\n    : block[0]\n  if(typeof data === 'string') block[0] = data\n  if(typeof data === 'object') block = data\n\n  block[1] = typeof block[1] === 'object'\n    ? Object.keys(block[1]).reduce((attrs, key) => {\n        let useKey = selectorCheck.attrKeyConvert[key]\n          ? runAction({\n              action: selectorCheck.attrKeyConvert[key],\n              node: block,\n              value: block[1][key],\n              key,\n              nodes,\n              children\n            }, 'key')\n          : key\n\n        if(useKey && block[1][key]){\n          attrs[useKey] = selectorCheck.attrValueConvert[key]\n            ? runAction({\n                action: selectorCheck.attrValueConvert[key],\n                node: block,\n                value: block[1][key],\n                key,\n                nodes,\n                children\n              }, 'value')\n            : typeof block[1][key] === 'string'\n              ? unquote(block[1][key])\n              : block[1][key]\n        }\n\n        return attrs\n      }, {})\n    : {}\n\n  if(block[2] &&  typeof block[2] !== 'string' && block[2].length){\n    block[2] = block[2].map(child => {\n      return convertBlock(child, nodes, children)\n    })\n  }\n\n  return block\n}\n\nconst buildBlock = (org, added, nodes, children) => {\n  org[0] = added[0]\n  org[1] = Object.assign({}, org[1], added[1])\n  if(added[2]) org[2] = added[2]\n  return convertBlock(org, nodes, children)\n}\n\nconst tagConvert = (args) => {\n  const { action, node, value, nodes, children } = args\n  let { block } = args\n\n  const tagName = node[0]\n  if(!tagName) return block\n  block[0] = options.lowerCaseTag\n    ? tagName.toLowerCase()\n    : tagName\n\n  if(typeof action === 'function'){\n    let data = runAction({\n      key: '$$DOM_TAG_NAME',\n      value: block[0],\n      action,\n      node,\n      nodes,\n      children\n    }, 'value')\n    if(!data) return block\n    if(typeof data === 'string') data = { 0: data }\n    \n    if(typeof data === 'object')\n      return buildBlock(block, data, nodes, children)\n  }\n  else if(typeof action === 'object' && !Array.isArray(action) && action[0]){\n    return buildBlock(block, action, nodes, children)\n  }\n  else {\n    const data = runAction({\n      key: '$$DOM_TAG_NAME',\n      value: block[0],\n      action,\n      node,\n      nodes,\n      children\n    }, 'value')\n    if(typeof data === 'string') block[0] = data\n    if(typeof data === 'object'){\n      block = buildBlock(block, data, nodes, children)\n    }\n  }\n  \n  \n  return block\n}\n\n// ----------- Formatters ----------- //\nconst format = (args) => {\n  const { parent, children } = args\n  let { childs, nodes, } = args\n\n  return childs\n    ? childs.reduce((children, node) => {\n        nodes = nodes || childs\n        const child = node.type === 'text' || node.type === 'comment'\n          ? filterFS(node, parent)\n          : formatNode(node, childs, nodes, children)\n        child && children.push(child)\n        return children\n      }, [])\n    : []\n}\n\nconst formatNode = (node, nodes, children) => {\n  const block = selectorCheck.tagConvert[node[0]]\n    ? tagConvert({\n        action: selectorCheck.tagConvert[node[0]],\n        block: {},\n        value: node[0],\n        node,\n        nodes,\n        children\n      })\n    : { 0: node[0] }\n\n  // Build any of the current attrs\n  const attrs = formatAttributes({\n    attributes: node[1],\n    node,\n    nodes,\n    children\n  })\n\n  // current attr data get merge after the data from the node\n  // This is because the only way the block will have attrs is if it was tagConverted\n  block[1] = Object.assign({}, attrs, block[1])\n\n  const childs = format({\n    childs: node[2],\n    parent: block,\n    nodes,\n    children\n  })\n  return addChildren(block, childs)\n}\n\nconst formatAttributes = (args) => {\n  const { node, nodes, children } = args\n  let { attributes } = args\n  attributes = attributes || {}\n  const attrs = {}\n\n  Object.keys(attributes).map(item => {\n    const parts = [ item, attributes[item]]\n\n    const key = selectorCheck.attrKeyConvert[parts[0]]\n      ? runAction({\n          action: selectorCheck.attrKeyConvert[parts[0]],\n          key: parts[0],\n          value: parts[1],\n          node,\n          nodes,\n          children\n        }, 'key')\n      : parts[0]\n  \n    const value = typeof parts[1] === 'string'\n      ? formatValue({\n          key: parts[0],\n          value: parts[1],\n          node,\n          nodes,\n          children\n        })\n      : null\n    if(key) attrs[key] = value || 'true'\n  })\n  \n  if(attrArrEmpty) return attrs\n  \n  return addAttribute({\n    node,\n    attrs,\n    nodes,\n    children\n  })\n  \n}\n\nconst formatValue = (args) => {\n  const { node, key, value, nodes, children } = args\n  return key === 'style' && typeof value === 'string'\n    ? convertStyle(unquote(value))\n    : selectorCheck.attrValueConvert[key]\n      ? runAction({\n          action: selectorCheck.attrValueConvert[key],\n          value: unquote(value),\n          node,\n          key,\n          nodes,\n          children\n        }, 'value')\n      : unquote(value)\n}\n\n// ----------- Run options methods ----------- //\nconst runAction = (args, def) => {\n  const { action, node, key, value, nodes, children } = args\n  \n  switch(typeof action){\n    case 'string':\n      return action || args[def]\n    case 'function':\n      \n    \n      return action({\n        0: node[0],\n        1: node[1],\n        2: node[2]\n      }, key, value, nodes, children, options) || args[def]\n    case 'object':\n      let shouldUpdateValue = false\n      // Get the tag type to be checked\n      const tagType = node[0]\n       if(!tagType) return args[def]\n      \n      // Get the node attrs if there are any\n      const nodeAttrs = node[1]\n      const attsIsArr = Array.isArray(nodeAttrs)\n\n      // Get the selector to check\n      const selector = action[tagType]\n      // if none, return the default\n      if(!selector) return args[def]\n      \n      \n      // Get the update value\n      const updateVal = selector.value || action.value\n\n      // if none, return the default\n      if(!updateVal) return args[def]\n\n      // Check if it's an all selector, if it is, set the value\n      if(selector.all) shouldUpdateValue = true\n      else {\n        // return the default if it's not a select all and no attrs exist\n        if(!nodeAttrs) return args[def]\n        \n        // Loop the slector and check if any of the elements attrs match\n        Object.keys(selector).map(key => {\n          // If the updateVaule is already set, stop checking\n          if(shouldUpdateValue) return\n          \n          let toCheck = `${key}=\"${selector[key]}\"`\n          if(attsIsArr){\n            shouldUpdateValue = key !== 'data'\n              ? nodeAttrs.indexOf(toCheck) !== -1\n              : nodeAttrs.reduce((isValid, attr) => {\n                  return isValid || ( selector[key].indexOf('=') !== -1\n                    ? selector[key] === attr\n                    : selector[key] === attr.split('=')[0]\n                  )\n                }, false)\n          }\n          else {\n            let useKey = key\n            if(key === 'data') useKey = selector[key].split('=')[0]\n            // if nodeAttrs is an object, and the key does not exsits, then return\n            if(!nodeAttrs[useKey]) return\n            shouldUpdateValue = selector[key].indexOf('=') !== -1\n              // If select as = we are looking for more specific, so\n              // build key from nodeAttrs and test it\n              ? `${useKey}=\"${nodeAttrs[useKey]}\"` === selector[key]\n              // Otherwise return true, because we know the nodeAttrs has the key\n              : true\n          }\n        })\n      }\n      \n      if(shouldUpdateValue){\n        // If we should update, set the update based on type\n        if(typeof updateVal === 'string' || typeof updateVal === 'object') return updateVal\n        else if(typeof updateVal === 'function'){\n          return updateVal({\n            0: node[0],\n            1: node[1],\n            2: node[2]\n          }, key, value, nodes, children, options) || args[def]\n        }\n      }\n      // If we should not update the elment, return the default\n      return args[def]\n\n    default:\n      return action || args[def]\n  }\n}\n\n// ----------- Helpers ----------- //\nconst addAttribute = (args) => {\n  const { node, attrs, nodes, children } = args\n  \n  Object.keys(selectorCheck.attrKeyAdd).map(key => {\n    const value = runAction({\n      action: selectorCheck.attrKeyAdd[key],\n      key,\n      node,\n      nodes,\n      children\n    })\n\n    if(value) attrs[key] = value\n  })\n\n  return attrs\n}\n\n\nconst filterFS = (node) => {\n  let start = ''\n  let end = ''\n  let text = node.content\n\n  if (node.type === 'comment') {\n    if(!options.comments) return null\n    start = '<!--'\n    end = '-->'\n  }\n  if (options.trim) {\n    return node.content.trim() !== '\\n' && node.content.replace(/\\s/g, '').length > 0\n      ? start + node.content.trim() + end\n      : null\n  }\n  return text\n    ? start + text + end\n    : null\n}\n\nexport const formatFS = (nodes, _options) => {\n  let rootFS = Object.assign({}, options.root, _options.root)\n  Object.assign(options, _options)\n  selectorCheck = setupSelectors(selectorCheck, options)\n  attrArrEmpty = Object.keys(options.attrKeyAdd).length === 0\n  \n  if(selectorCheck.tagConvert[rootFS[0]]){\n    rootFS = tagConvert({\n      action: selectorCheck.tagConvert[rootFS[0]],\n      block: rootFS,\n      value: rootFS[0],\n      node: rootFS,\n      children: nodes,\n      nodes,\n    })\n  }\n  rootFS[1] = formatAttributes({\n    attributes: rootFS[1],\n    node: rootFS,\n    children: nodes,\n    nodes\n  })\n\n  rootFS[2] = Array.isArray(rootFS[2])\n  ? rootFS[2].map(child => {\n      return convertBlock(child, nodes, nodes)\n    })\n  : []\n\n  return addChildren(rootFS, format({\n    childs: nodes,\n    parent: rootFS,\n  }))\n}"]}